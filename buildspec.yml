version: 0.2 
  phases: 
    install: 
    runtime-versions: 
      python: 3.8 
    pre_build: 
      commands:
            - echo Logging in to Amazon ECR... 
            - aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 104419566744.dkr.ecr.eu-west-1.amazonaws.com 
            - REPOSITORY_URI=104419566744.dkr.ecr.eu-west-1.amazonaws.com/python-demo-ecr 
            - IMAGE_TAG=latest 
    build: 
      commands: 
        - echo build started on date 
        - echo Building the project... 
        - python setup.py build 
        - echo Building -t $REPOSITORY_URI:latest . 
        - docker tag $REPOSITORY_URI:latest $REPOSITORY_URI:$IMAGE_TAG 
    post_build: 
    commands: 
          - echo Build completed on date 
          - echo pushing to repo 
          - docker push $REPOSITORY_URI:latest 
          - docker push $REPOSITORY_URI:$IMAGE_TAG 
          - echo Writing image definitions file... 
          - DOCKER_CONTAINER_NAME=python-demo-ecr 
          - printf '[{"name":"python-demo-ecr","imageUri":"%s"}]' $DOCKER_CONTAINER_NAME $REPOSITORY_URI:$IMAGE_TAG > imagedefinitions.json 
          - echo $DOCKER_CONTAINER_NAME 
          - echo printing imagedefinitions.json 
          - cat imagedefinitions.json 
    artifacts: 
      files: 
        - imagedefinitions.json
  